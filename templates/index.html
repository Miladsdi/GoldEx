<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoldEx | Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø·Ù„Ø§ Ùˆ Ø§Ø±Ø²</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #0e1a2b;
        font-family: "Vazirmatn", sans-serif;
        color: #fff;
    }
    .container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
    }
    .card {
        background: #14263b;
        padding: 20px;
        border-radius: 14px;
        margin-bottom: 25px;
        box-shadow: 0 0 25px rgba(0,0,0,0.35);
    }
    h2 {
        margin-top: 0;
        text-align: center;
    }
    select, input {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: none;
        margin: 12px 0;
        font-size: 15px;
    }
    button {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: none;
        margin-top: 6px;
        cursor: pointer;
        background: #08c0ff;
        color: #000;
        font-size: 17px;
        font-weight: bold;
    }
    .result {
        margin-top: 15px;
        background: #0e1f31;
        padding: 12px;
        border-radius: 10px;
        font-size: 16px;
        line-height: 2;
    }
    .live {
        background: #112233;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 20px;
        line-height: 2;
    }
    .adv-box {
        display: none;
        margin-top: 12px;
        padding: 12px;
        background: #18314f;
        border-radius: 10px;
    }
    #advToggle {
        margin-top: 15px;
        background: #ffcc00;
    }
</style>
</head>

<body>
<div class="container">

    <!-- LIVE PRICES -->
    <div class="live" id="liveBox">
        â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ...
    </div>

    <!--  ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø·Ù„Ø§ -->
    <div class="card">
        <h2>ğŸ¥‡ ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø·Ù„Ø§</h2>
        <label>Ù…Ø¨Ù„Øº Ø´Ù…Ø§ (ØªÙˆÙ…Ø§Ù†)</label>
        <input type="number" id="goldAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹ 50000000">
        <div id="goldWords"></div>

        <label>Ù†ÙˆØ¹ Ø·Ù„Ø§</label>
        <select id="goldType">
            <option value="gold18">Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</option>
            <option value="gold24">Ø·Ù„Ø§ÛŒ Û²Û´ Ø¹ÛŒØ§Ø±</option>
        </select>

        <button onclick="calcGold()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ø·Ù„Ø§</button>

        <div class="result" id="goldResult"></div>
    </div>

    <!-- ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø§Ø±Ø² -->
    <div class="card">
        <h2>ğŸ’µ ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† Ùˆ Ø§Ø±Ø²</h2>
        <label>Ù…Ø¨Ù„Øº</label>
        <input type="number" id="fxAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹ 50000000">
        <div id="fxWords"></div>

        <label>Ù†ÙˆØ¹ Ø§Ø±Ø²</label>
        <select id="fxType"></select>

        <button onclick="calcFx()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>

        <div class="result" id="fxResult"></div>
    </div>

    <button id="advToggle" onclick="toggleAdv()">ğŸ”§ Ø­Ø§Ù„Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡</button>

    <div class="adv-box" id="advBox">
        <p>âœ” ÙØ±Ù…ÙˆÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø·Ù„Ø§</p>
        <p>âœ” Ø§Ø¬Ø±Øª Ø³Ø§Ø®Øª + Ø³ÙˆØ¯ + Ù…Ø§Ù„ÛŒØ§Øª</p>
        <p>âœ” Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø¹Ø§Ù…Ù„Ù‡</p>
    </div>

</div>

<script>
//---------------------------------------
// ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ â†’ Ø­Ø±ÙˆÙ
//---------------------------------------
function numberToWords(num) {
    if (!num) return "";
    return new Intl.NumberFormat('fa-IR', { style: 'currency', currency: 'IRR' })
        .format(num).replace("Ø±ÛŒØ§Ù„", "ØªÙˆÙ…Ø§Ù†");
}

//---------------------------------------
// Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø§Ø² API (Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ)
//---------------------------------------
let prices = {};

async function loadPrices() {
    try {
        const res = await fetch("/api/prices");
        const json = await res.json();
        prices = json.data;

        document.getElementById("liveBox").innerHTML = `
            ğŸ’° Ø¯Ù„Ø§Ø±: ${prices.usd.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸ’¶ ÛŒÙˆØ±Ùˆ: ${prices.eur.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸ¥‡ Ø·Ù„Ø§ Û±Û¸: ${prices.gold18.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸ¥‡ Ø·Ù„Ø§ Û²Û´: ${prices.gold24.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸ“€ Ù…Ø¸Ù†Ù‡: ${prices.mozane.toLocaleString()} ØªÙˆÙ…Ø§Ù†
        `;

        // Ø§Ø±Ø²Ù‡Ø§
        let fxSel = document.getElementById("fxType");
        fxSel.innerHTML = "";
        Object.keys(prices).forEach(key => {
            if (["usd","eur","gbp","try","aed"].includes(key)) {
                fxSel.innerHTML += `<option value="${key}">${key.toUpperCase()}</option>`;
            }
        });

    } catch {
        document.getElementById("liveBox").innerHTML = "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§";
    }
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø± 10 Ø«Ø§Ù†ÛŒÙ‡
loadPrices();
setInterval(loadPrices, 10000);

//---------------------------------------
// ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† â†’ Ø·Ù„Ø§
//---------------------------------------
function calcGold() {
    let amount = Number(document.getElementById("goldAmount").value);
    let type = document.getElementById("goldType").value;

    document.getElementById("goldWords").innerText = numberToWords(amount);

    if (!amount || !prices[type]) return;

    let gram = amount / prices[type];
    document.getElementById("goldResult").innerHTML =
        `ğŸ“Œ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø­Ø¯ÙˆØ¯ <b>${gram.toFixed(2)}</b> Ú¯Ø±Ù… ${type === "gold18" ? "Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±" : "Ø·Ù„Ø§ÛŒ Û²Û´ Ø¹ÛŒØ§Ø±"} Ø¨Ø®Ø±ÛŒØ¯.`;
}

//---------------------------------------
// ØªØ¨Ø¯ÛŒÙ„ ØªÙˆÙ…Ø§Ù† â†’ Ø§Ø±Ø²
//---------------------------------------
function calcFx() {
    let amount = Number(document.getElementById("fxAmount").value);
    let type = document.getElementById("fxType").value;

    document.getElementById("fxWords").innerText = numberToWords(amount);

    if (!amount || !prices[type]) return;

    let qty = amount / prices[type];
    document.getElementById("fxResult").innerHTML =
        `ğŸ“Œ Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø®Ø±ÛŒØ¯: <b>${qty.toFixed(4)}</b> ${type.toUpperCase()}`;
}

//---------------------------------------
// Ø­Ø§Ù„Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡
//---------------------------------------
function toggleAdv() {
    let box = document.getElementById("advBox");
    box.style.display = box.style.display === "block" ? "none" : "block";
}
</script>

</body>
</html>
